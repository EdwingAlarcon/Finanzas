<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Finanzas Personales</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Panel de finanzas personales para gestionar ingresos, gastos y ahorros">
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Finanzas">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    
    <!-- Estilos CSS Modulares -->
    <link rel="stylesheet" href="css/main.css">
    
    <!-- Chart.js CDN - Carga diferida para mejor rendimiento -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    
    <!-- jsPDF para generaci√≥n de reportes PDF - Carga diferida -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js" defer></script>
    
    <!-- SheetJS para exportar/importar Excel - Carga diferida -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
</head>
<body>

    <!-- ==================== PIN DE SEGURIDAD ==================== -->
    <div class="pin-overlay" id="pin-overlay">
        <div class="pin-container">
            <h2>üîê Acceso Seguro</h2>
            <p id="pin-mensaje">Ingresa tu PIN de 4 d√≠gitos</p>
            <div class="pin-input-container">
                <input type="password" class="pin-input" maxlength="1" id="pin-1" oninput="moverPinInput(1)" onkeydown="manejarBackspacePin(event, 1)">
                <input type="password" class="pin-input" maxlength="1" id="pin-2" oninput="moverPinInput(2)" onkeydown="manejarBackspacePin(event, 2)">
                <input type="password" class="pin-input" maxlength="1" id="pin-3" oninput="moverPinInput(3)" onkeydown="manejarBackspacePin(event, 3)">
                <input type="password" class="pin-input" maxlength="1" id="pin-4" oninput="moverPinInput(4)" onkeydown="manejarBackspacePin(event, 4)">
            </div>
            <p class="pin-error" id="pin-error">PIN incorrecto. Intenta de nuevo.</p>
            <button class="btn btn-primario" onclick="verificarPin()" id="btn-pin">Ingresar</button>
            <p style="margin-top: 15px; font-size: 0.8rem; color: var(--color-texto-terciario);">
                <a href="#" onclick="mostrarConfigPin()" style="color: var(--color-primario);">Configurar/Cambiar PIN</a>
            </p>
        </div>
    </div>

    <!-- ==================== NOTIFICACI√ìN TOAST ==================== -->
    <div class="notificacion-toast" id="notificacion-toast">
        <span class="toast-icono">‚ö†Ô∏è</span>
        <div class="toast-contenido">
            <strong id="toast-titulo">T√≠tulo</strong>
            <p id="toast-mensaje" style="margin: 0; font-size: 0.85rem;">Mensaje</p>
        </div>
        <span class="cerrar-toast" onclick="cerrarToast()">√ó</span>
    </div>

    <!-- ==================== ENCABEZADO ==================== -->
    <header>
        <!-- Selector de tema -->
        <div class="tema-selector">
            <button class="tema-btn activo" data-tema-valor="claro" onclick="cambiarTema('claro')" title="Tema Claro">‚òÄÔ∏è</button>
            <button class="tema-btn" data-tema-valor="oscuro" onclick="cambiarTema('oscuro')" title="Tema Oscuro">üåô</button>
            <button class="tema-btn" data-tema-valor="naturaleza" onclick="cambiarTema('naturaleza')" title="Tema Naturaleza">üåø</button>
            <button class="tema-btn" data-tema-valor="oceano" onclick="cambiarTema('oceano')" title="Tema Oc√©ano">üåä</button>
        </div>
        <h1>üí∞ Panel de Finanzas Personales</h1>
        <p>Organiza tus ingresos, gastos y ahorros en un solo lugar</p>
    </header>

    <div class="container">
        
        <!-- ==================== SECCI√ìN DE RESUMEN ==================== -->
        <div class="resumen">
            <!-- Tarjeta de ingresos totales -->
            <div class="tarjeta ingresos">
                <div class="icono">üìà</div>
                <h3>Ingresos del Mes</h3>
                <div class="monto" id="total-ingresos">$0</div>
                <div class="subtexto" id="count-ingresos">0 transacciones</div>
            </div>
            
            <!-- Tarjeta de gastos totales -->
            <div class="tarjeta gastos">
                <div class="icono">üìâ</div>
                <h3>Gastos del Mes</h3>
                <div class="monto" id="total-gastos">$0</div>
                <div class="subtexto" id="count-gastos">0 transacciones</div>
            </div>
            
            <!-- Tarjeta de balance -->
            <div class="tarjeta balance">
                <div class="icono">‚öñÔ∏è</div>
                <h3>Balance del Mes</h3>
                <div class="monto" id="balance">$0</div>
                <div class="subtexto" id="balance-estado">Neutro</div>
            </div>
            
            <!-- Tarjeta de ahorro -->
            <div class="tarjeta ahorro">
                <div class="icono">üéØ</div>
                <h3>Objetivo de Ahorro</h3>
                <div class="monto" id="ahorro-porcentaje">0%</div>
                <div class="subtexto" id="ahorro-estado">Sin objetivo</div>
            </div>

            <!-- Tarjeta de transacciones totales -->
            <div class="tarjeta transacciones">
                <div class="icono">üìä</div>
                <h3>Total Hist√≥rico</h3>
                <div class="monto" id="total-transacciones">0</div>
                <div class="subtexto">movimientos registrados</div>
            </div>
        </div>

        <!-- ==================== NAVEGACI√ìN POR TABS ==================== -->
        <nav class="tabs-navegacion" role="tablist" aria-label="Secciones principales">
            <button class="tab-btn activo" onclick="cambiarTab('movimientos')" role="tab" aria-selected="true" aria-controls="tab-movimientos" id="tab-btn-movimientos">
                <span class="tab-icono">üìã</span>
                <span class="tab-texto">Movimientos</span>
            </button>
            <button class="tab-btn" onclick="cambiarTab('estadisticas')" role="tab" aria-selected="false" aria-controls="tab-estadisticas" id="tab-btn-estadisticas">
                <span class="tab-icono">üìä</span>
                <span class="tab-texto">Estad√≠sticas</span>
            </button>
            <button class="tab-btn" onclick="cambiarTab('configuracion')" role="tab" aria-selected="false" aria-controls="tab-configuracion" id="tab-btn-configuracion">
                <span class="tab-icono">‚öôÔ∏è</span>
                <span class="tab-texto">Configuraci√≥n</span>
            </button>
        </nav>

        <!-- ==================== TAB: MOVIMIENTOS ==================== -->
        <div class="tab-contenido activo" id="tab-movimientos" role="tabpanel" aria-labelledby="tab-btn-movimientos">

            <!-- Secci√≥n de Registro de Movimientos -->
            <section class="tab-seccion">
                <h2>‚ûï Registrar Nuevo Movimiento</h2>
                
                <!-- Mensaje de estado para feedback al usuario -->
                <div class="mensaje" id="mensaje"></div>
                
                <!-- Formulario para agregar transacciones -->
                <form id="formulario-movimiento" onsubmit="agregarMovimiento(event)">
                    <div class="formulario-grid">
                        <!-- Campo de tipo de transacci√≥n -->
                        <div class="campo">
                            <label for="tipo">Tipo *</label>
                            <select id="tipo" required>
                                <option value="">Seleccionar...</option>
                                <option value="Ingreso">Ingreso</option>
                                <option value="Gasto">Gasto</option>
                                <option value="Ahorro">Ahorro üê∑</option>
                            </select>
                        </div>
                        
                        <!-- Campo de categor√≠a -->
                        <div class="campo">
                            <label for="categoria">Categor√≠a *</label>
                            <select id="categoria" required>
                                <option value="">Seleccionar...</option>
                                <!-- Las categor√≠as se cargan din√°micamente -->
                            </select>
                        </div>
                        
                        <!-- Campo de monto -->
                        <div class="campo">
                            <label for="monto">Monto ($) *</label>
                            <input type="number" id="monto" placeholder="Ej: 50000" min="0.01" step="0.01" required>
                        </div>
                        
                        <!-- Campo de fecha -->
                        <div class="campo">
                            <label for="fecha">Fecha *</label>
                            <input type="date" id="fecha" required>
                        </div>
                        
                        <!-- Campo de descripci√≥n opcional -->
                        <div class="campo" style="grid-column: 1 / -1;">
                            <label for="descripcion">Descripci√≥n (opcional)</label>
                            <textarea id="descripcion" placeholder="Ej: Pago de n√≥mina quincenal..."></textarea>
                        </div>

                        <!-- Campo de etiquetas -->
                        <div class="campo" style="grid-column: 1 / -1;">
                            <label for="etiquetas">Etiquetas (separadas por coma)</label>
                            <input type="text" id="etiquetas" placeholder="Ej: trabajo, mensual, importante">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primario">Agregar Movimiento</button>
                </form>
            </section>

            <!-- Secci√≥n de Historial de Movimientos -->
            <section class="tab-seccion">
                <h2>üìã Historial de Movimientos</h2>
                
                <!-- Herramientas de exportaci√≥n -->
                <div class="herramientas">
                    <button class="btn btn-secundario btn-pequeno" onclick="exportarCSV()">üì• Exportar CSV</button>
                    <button class="btn btn-secundario btn-pequeno" onclick="exportarJSON()">üì¶ Exportar JSON</button>
                    <button class="btn btn-eliminar btn-pequeno" onclick="limpiarTodosDatos()">üóëÔ∏è Limpiar Todo</button>
                </div>
                
                <!-- Filtros para la tabla -->
                <div class="filtros">
                    <div class="busqueda-container">
                        <input type="text" id="filtro-busqueda" placeholder="Buscar en descripci√≥n..." oninput="aplicarFiltrosConDebounce()" aria-label="Buscar movimientos">
                    </div>
                    <div class="campo">
                        <label for="filtro-tipo">Filtrar por tipo</label>
                        <select id="filtro-tipo" onchange="aplicarFiltros()">
                            <option value="">Todos</option>
                            <option value="Ingreso">Ingresos</option>
                            <option value="Gasto">Gastos</option>
                            <option value="Ahorro">Ahorros</option>
                        </select>
                    </div>
                    <div class="campo">
                        <label for="filtro-categoria">Filtrar por categor√≠a</label>
                        <select id="filtro-categoria" onchange="aplicarFiltros()">
                            <option value="">Todas</option>
                            <!-- Las opciones se llenar√°n din√°micamente -->
                        </select>
                    </div>
                    <div class="campo">
                        <label for="filtro-fecha-desde">Desde</label>
                        <input type="date" id="filtro-fecha-desde" onchange="aplicarFiltros()">
                    </div>
                    <div class="campo">
                        <label for="filtro-fecha-hasta">Hasta</label>
                        <input type="date" id="filtro-fecha-hasta" onchange="aplicarFiltros()">
                    </div>
                    <button class="btn btn-secundario" onclick="limpiarFiltros()">Limpiar filtros</button>
                </div>
                
                <!-- Tabla de movimientos -->
                <div class="tabla-container" role="region" aria-label="Historial de movimientos">
                    <table id="tabla-movimientos" role="table" aria-describedby="tabla-descripcion">
                        <caption id="tabla-descripcion" class="sr-only">Lista de movimientos financieros con fecha, tipo, categor√≠a, descripci√≥n y monto</caption>
                        <thead>
                            <tr role="row">
                                <th onclick="ordenarTabla('fecha')">
                                    Fecha <span class="flecha" id="flecha-fecha"></span>
                                </th>
                                <th onclick="ordenarTabla('tipo')">
                                    Tipo <span class="flecha" id="flecha-tipo"></span>
                                </th>
                                <th onclick="ordenarTabla('categoria')">
                                    Categor√≠a <span class="flecha" id="flecha-categoria"></span>
                                </th>
                                <th>Descripci√≥n</th>
                                <th onclick="ordenarTabla('monto')">
                                    Monto <span class="flecha" id="flecha-monto"></span>
                                </th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpo-tabla">
                            <!-- Los movimientos se renderizar√°n aqu√≠ din√°micamente -->
                        </tbody>
                    </table>
                    
                    <!-- Mensaje cuando no hay datos -->
                    <div class="sin-datos empty-state" id="sin-datos">
                        <div class="empty-state-icon">üìä</div>
                        <h3>No hay movimientos registrados</h3>
                        <p>¬°Comienza agregando tu primer ingreso, gasto o ahorro para llevar el control de tus finanzas!</p>
                        <button class="btn btn-primario" onclick="document.getElementById('tipo').focus();">
                            ‚ûï Agregar primer movimiento
                        </button>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de Calendario -->
            <section class="tab-seccion">
                <h2>üìÖ Calendario de Movimientos</h2>
                <div class="calendario-container">
                    <div class="calendario-header">
                        <h3 id="calendario-titulo">Diciembre 2025</h3>
                        <div class="calendario-nav">
                            <button onclick="navegarCalendario(-1)">‚óÄ</button>
                            <button onclick="navegarCalendario(0)">Hoy</button>
                            <button onclick="navegarCalendario(1)">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="calendario-grid" id="calendario-grid">
                        <!-- Se llena din√°micamente -->
                    </div>
                    <div class="calendario-detalle" id="calendario-detalle">
                        <h4 id="calendario-detalle-fecha">Movimientos del d√≠a</h4>
                        <div id="calendario-detalle-lista"></div>
                    </div>
                </div>
            </section>

        </div>

        <!-- ==================== TAB: ESTAD√çSTICAS ==================== -->
        <div class="tab-contenido" id="tab-estadisticas" role="tabpanel" aria-labelledby="tab-btn-estadisticas">

            <!-- Secci√≥n de Resumen por Categor√≠as -->
            <section class="tab-seccion">
                <h2>üìä Resumen por Categor√≠as (Este Mes)</h2>
                <div class="categorias-grid" id="resumen-categorias">
                    <!-- Se llena din√°micamente -->
                </div>
                <div class="sin-datos" id="sin-categorias" style="display: none;">
                    Agrega movimientos para ver el resumen por categor√≠as.
                </div>
            </section>

            <!-- Secci√≥n de Gr√°ficos -->
            <section class="tab-seccion">
                <h2>üìà Gr√°ficos y Estad√≠sticas</h2>
                
                <!-- Selector de per√≠odo -->
                <div class="periodo-selector">
                    <label for="grafico-mes">Mes:</label>
                    <select id="grafico-mes" onchange="actualizarGraficos()">
                        <!-- Se llena din√°micamente -->
                    </select>
                    <label for="grafico-anio">A√±o:</label>
                    <select id="grafico-anio" onchange="actualizarGraficos()">
                        <!-- Se llena din√°micamente -->
                    </select>
                </div>
                
                <div class="graficos-container">
                    <div class="grafico-wrapper">
                        <h4>Distribuci√≥n de Gastos</h4>
                        <canvas id="grafico-gastos" class="grafico-canvas"></canvas>
                    </div>
                    <div class="grafico-wrapper">
                        <h4>Ingresos vs Gastos</h4>
                        <canvas id="grafico-balance" class="grafico-canvas"></canvas>
                    </div>
                    <div class="grafico-wrapper">
                        <h4>Tendencia Mensual</h4>
                        <canvas id="grafico-tendencia" class="grafico-canvas"></canvas>
                    </div>
                    <div class="grafico-wrapper">
                        <h4>Distribuci√≥n de Ingresos</h4>
                        <canvas id="grafico-ingresos" class="grafico-canvas"></canvas>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de Control de Gastos -->
            <section class="tab-seccion">
                <h2>üí∞ Control de Gastos por Categor√≠a</h2>
                <p style="color: var(--color-texto-secundario); margin-bottom: 15px;">
                    üìä Comparaci√≥n autom√°tica de tus gastos actuales vs. el promedio de los √∫ltimos 3 meses.
                </p>
                
                <div class="presupuestos-grid" id="presupuestos-lista">
                    <!-- Se llena din√°micamente -->
                </div>
                <div class="sin-datos" id="sin-presupuestos" style="display: none;">
                    A√∫n no tienes gastos registrados. ¬°Comienza a registrar para ver el an√°lisis!
                </div>
            </section>

        </div>

        <!-- ==================== TAB: CONFIGURACI√ìN ==================== -->
        <div class="tab-contenido" id="tab-configuracion" role="tabpanel" aria-labelledby="tab-btn-configuracion">

            <!-- Secci√≥n de Objetivo de Ahorro -->
            <section class="tab-seccion">
            <h2>üéØ Objetivo de Ahorro Mensual</h2>
            <div class="objetivo-container">
                <div class="objetivo-input">
                    <div class="campo">
                        <label for="objetivo-monto">Meta de ahorro ($)</label>
                        <input type="number" id="objetivo-monto" placeholder="Ej: 500000" min="0">
                    </div>
                    <button class="btn btn-primario" onclick="guardarObjetivo()">Establecer Objetivo</button>
                </div>
                <div class="progreso-container">
                    <div class="progreso-info">
                        <span>Ahorrado: <strong id="monto-ahorrado">$0</strong></span>
                        <span>Meta: <strong id="meta-ahorro">$0</strong></span>
                    </div>
                    <div class="progreso-barra">
                        <div class="progreso-relleno" id="progreso-relleno" style="width: 0%"></div>
                    </div>
                    <div class="progreso-porcentaje" id="progreso-porcentaje">0%</div>
                </div>
            </div>
        </section>

            <!-- Secci√≥n de Gesti√≥n de Categor√≠as -->
            <section class="tab-seccion">
                <h2>üè∑Ô∏è Gestionar Categor√≠as</h2>
                <p style="color: var(--color-texto-secundario); margin-bottom: 15px;">Agrega tus propias categor√≠as personalizadas para organizar mejor tus finanzas.</p>
                
                <div class="categorias-personalizadas">
                    <h4>üì• Categor√≠as de Ingreso</h4>
                    <div class="lista-categorias" id="lista-categorias-ingreso">
                        <!-- Se llenan din√°micamente -->
                    </div>
                    
                    <h4 style="margin-top: 20px;">üì§ Categor√≠as de Gasto</h4>
                    <div class="lista-categorias" id="lista-categorias-gasto">
                        <!-- Se llenan din√°micamente -->
                    </div>
                    
                    <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-borde);">
                    
                    <h4>‚ûï Agregar Nueva Categor√≠a</h4>
                    <div class="agregar-categoria-form">
                        <div class="campo">
                            <label for="nueva-categoria-tipo">Tipo</label>
                            <select id="nueva-categoria-tipo">
                                <option value="Ingreso">Ingreso</option>
                                <option value="Gasto">Gasto</option>
                            </select>
                        </div>
                        <div class="campo">
                            <label for="nueva-categoria-nombre">Nombre de la categor√≠a</label>
                            <input type="text" id="nueva-categoria-nombre" placeholder="Ej: Bonificaciones">
                        </div>
                        <div class="campo">
                            <label for="nueva-categoria-icono">Icono (emoji)</label>
                            <input type="text" id="nueva-categoria-icono" placeholder="Ej: üéÅ" maxlength="2">
                        </div>
                        <button class="btn btn-exito" onclick="agregarCategoriaPersonalizada()">Agregar</button>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de Movimientos Recurrentes -->
            <section class="tab-seccion">
                <h2>üîÑ Movimientos Recurrentes</h2>
                <p style="color: var(--color-texto-secundario); margin-bottom: 15px;">
                    Configura ingresos o gastos que se repiten autom√°ticamente (salario, suscripciones, arriendo).
                </p>
                
                <div class="recurrentes-lista" id="recurrentes-lista">
                    <!-- Se llena din√°micamente -->
                </div>
                <div class="sin-datos" id="sin-recurrentes" style="display: none;">
                    No hay movimientos recurrentes configurados.
                </div>
                
                <div class="agregar-categoria-form" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--color-borde);">
                    <div class="campo">
                        <label for="recurrente-tipo">Tipo</label>
                        <select id="recurrente-tipo" onchange="actualizarCategoriasRecurrente()">
                            <option value="Ingreso">Ingreso</option>
                            <option value="Gasto">Gasto</option>
                            <option value="Ahorro">Ahorro</option>
                        </select>
                    </div>
                    <div class="campo">
                        <label for="recurrente-categoria">Categor√≠a</label>
                        <select id="recurrente-categoria">
                            <!-- Se llena din√°micamente -->
                        </select>
                    </div>
                    <div class="campo">
                        <label for="recurrente-descripcion">Descripci√≥n</label>
                        <input type="text" id="recurrente-descripcion" placeholder="Ej: Salario mensual">
                    </div>
                    <div class="campo">
                        <label for="recurrente-monto">Monto ($)</label>
                        <input type="number" id="recurrente-monto" placeholder="Ej: 3000000" min="0">
                    </div>
                    <div class="campo">
                        <label for="recurrente-frecuencia">Frecuencia</label>
                        <select id="recurrente-frecuencia">
                            <option value="semanal">Semanal</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="mensual" selected>Mensual</option>
                            <option value="anual">Anual</option>
                        </select>
                    </div>
                    <div class="campo">
                        <label for="recurrente-dia">D√≠a del mes</label>
                        <input type="number" id="recurrente-dia" placeholder="1-31" min="1" max="31" value="1">
                    </div>
                    <button class="btn btn-exito" onclick="agregarRecurrente()">Agregar Recurrente</button>
                </div>
            </section>

            <!-- Secci√≥n de Importar/Exportar -->
            <section class="tab-seccion">
                <h2>üìÅ Almacenamiento y Respaldo de Datos</h2>
                
                <!-- Opciones de exportaci√≥n b√°sica -->
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">üì§ Exportar Datos</h4>
                    <div class="herramientas">
                        <button class="btn btn-exito" onclick="exportarExcel()">üìä Exportar Excel (.xlsx)</button>
                        <button class="btn btn-secundario" onclick="exportarCSV()">üìÖ Exportar CSV</button>
                        <button class="btn btn-secundario" onclick="exportarJSON()">üì¶ Exportar JSON</button>
                        <button class="btn btn-secundario" onclick="generarReportePDF()">üìã Reporte PDF</button>
                    </div>
                    <p style="color: var(--color-texto-terciario); font-size: 0.85rem; margin-top: 8px;">
                        ‚ú® <strong>Excel (.xlsx)</strong>: M√∫ltiples hojas con formato, ideal para an√°lisis avanzado
                    </p>
                </div>
                
                <!-- Importar archivo -->
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--color-borde);">
                    <h4 style="margin-bottom: 10px;">üìÇ Importar Datos</h4>
                    <div class="importar-zona" id="zona-importar" onclick="document.getElementById('archivo-importar').click()">
                        <p>üìÇ Arrastra un archivo aqu√≠ o haz clic para importar</p>
                        <p style="font-size: 0.85rem;">Soporta: <strong>.xlsx</strong> (Excel), .json (backup completo), .csv (movimientos)</p>
                        <input type="file" id="archivo-importar" class="importar-input" accept=".json,.csv,.xlsx,.xls" onchange="importarArchivo(event)">
                    </div>
                </div>

                <!-- File System API - Archivo Local Persistente -->
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--color-borde);">
                    <h4 style="margin-bottom: 10px;">üíæ Archivo Local Persistente</h4>
                    <p style="color: var(--color-texto-secundario); font-size: 0.9rem; margin-bottom: 15px;">
                        Guarda tus datos en un archivo en tu computadora. Sobrevive a limpieza de cach√©. 
                        <strong>Solo Chrome/Edge</strong>.
                    </p>
                    <div class="btn-grupo">
                        <button class="btn btn-primario" onclick="guardarArchivoLocal()">üíæ Guardar en Archivo</button>
                        <button class="btn btn-secundario" onclick="cargarArchivoLocal()">üìÇ Cargar desde Archivo</button>
                    </div>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9rem;">
                            <input type="checkbox" id="auto-guardar-archivo" onchange="toggleAutoGuardadoArchivo()">
                            Auto-guardar cada vez que haya cambios
                        </label>
                    </div>
                    <div class="sync-status" id="archivo-status" style="margin-top: 10px;">
                        <span>üìÑ</span>
                        <span id="archivo-texto">Sin archivo vinculado</span>
                    </div>
                </div>

                <!-- GitHub Gist - Sincronizaci√≥n en la Nube -->
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">‚òÅÔ∏è Sincronizaci√≥n con GitHub Gist</h4>
                    <p style="color: var(--color-texto-secundario); font-size: 0.9rem; margin-bottom: 15px;">
                        Guarda tus datos en la nube de forma gratuita. Accede desde cualquier dispositivo.
                    </p>
                    
                    <!-- Configuraci√≥n de GitHub -->
                    <div id="github-config" style="background: var(--color-fondo-secundario); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <div class="campo" style="margin-bottom: 10px;">
                            <label for="github-token">Token de GitHub (Personal Access Token)</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx" style="flex: 1;">
                                <button class="btn btn-secundario btn-pequeno" onclick="toggleVerToken()" title="Mostrar/Ocultar token">üëÅÔ∏è</button>
                            </div>
                            <small style="color: var(--color-texto-terciario); display: block; margin-top: 5px;">
                                <a href="#" onclick="mostrarAyudaGitHub()" style="color: var(--color-primario);">¬øC√≥mo obtener un token?</a> ‚Ä¢ 
                                <strong style="color: var(--color-exito);">Se guarda autom√°ticamente en tu navegador</strong>
                            </small>
                        </div>
                        <div class="campo" style="margin-bottom: 10px;">
                            <label for="gist-id">ID del Gist (opcional, para sincronizar con uno existente)</label>
                            <input type="text" id="gist-id" placeholder="Dejar vac√≠o para crear uno nuevo">
                        </div>
                        <button class="btn btn-exito btn-pequeno" onclick="guardarConfigGitHub()">üíæ Guardar Configuraci√≥n</button>
                    </div>
                    
                    <div class="btn-grupo">
                        <button class="btn btn-primario" onclick="sincronizarGitHub()">‚òÅÔ∏è Sincronizar con GitHub</button>
                        <button class="btn btn-secundario" onclick="cargarDesdeGitHub()">üì• Descargar de GitHub</button>
                    </div>
                    
                    <div class="sync-status" id="github-status" style="margin-top: 10px;">
                        <span class="sync-icon">‚òÅÔ∏è</span>
                        <span id="github-texto">No configurado</span>
                    </div>
                </div>

            </section>

        </div>
        <!-- Fin de TAB: CONFIGURACI√ìN -->

    </div>
    <!-- Fin de .container -->

    <!-- ==================== BOT√ìN FLOTANTE DE ACCI√ìN R√ÅPIDA ==================== -->
    <button class="btn-accion-flotante" onclick="toggleModalAccionRapida()" aria-label="Agregar movimiento r√°pido" title="Agregar movimiento">
        +
    </button>

    <!-- ==================== MODAL DE ACCI√ìN R√ÅPIDA ==================== -->
    <div class="modal-accion-rapida" id="modal-accion-rapida">
        <h3>‚ûï Agregar Movimiento R√°pido</h3>
        <div class="campo">
            <label for="rapido-tipo">Tipo</label>
            <select id="rapido-tipo" onchange="actualizarCategoriasRapido()">
                <option value="Gasto">Gasto</option>
                <option value="Ingreso">Ingreso</option>
                <option value="Ahorro">Ahorro</option>
            </select>
        </div>
        <div class="campo">
            <label for="rapido-categoria">Categor√≠a</label>
            <select id="rapido-categoria">
                <!-- Se llena din√°micamente -->
            </select>
        </div>
        <div class="campo">
            <label for="rapido-monto">Monto ($)</label>
            <input type="number" id="rapido-monto" placeholder="Ej: 50000" min="0.01" step="0.01">
        </div>
        <div class="campo">
            <label for="rapido-descripcion">Descripci√≥n</label>
            <input type="text" id="rapido-descripcion" placeholder="Ej: Almuerzo">
        </div>
        <div class="btn-grupo">
            <button class="btn btn-secundario btn-pequeno" onclick="toggleModalAccionRapida()">Cancelar</button>
            <button class="btn btn-primario btn-pequeno" onclick="agregarMovimientoRapido()">Agregar</button>
        </div>
    </div>

    <!-- ==================== MODAL DE EDICI√ìN ==================== -->
    <div class="modal-overlay" id="modal-editar">
        <div class="modal">
            <h3>‚úèÔ∏è Editar Movimiento</h3>
            <input type="hidden" id="editar-id">
            <div class="formulario-grid">
                <div class="campo">
                    <label for="editar-tipo">Tipo</label>
                    <select id="editar-tipo" onchange="actualizarCategoriasEditar()">
                        <option value="Ingreso">Ingreso</option>
                        <option value="Gasto">Gasto</option>
                        <option value="Ahorro">Ahorro</option>
                    </select>
                </div>
                <div class="campo">
                    <label for="editar-categoria">Categor√≠a</label>
                    <select id="editar-categoria"></select>
                </div>
                <div class="campo">
                    <label for="editar-monto">Monto ($)</label>
                    <input type="number" id="editar-monto" min="0.01" step="0.01">
                </div>
                <div class="campo">
                    <label for="editar-fecha">Fecha</label>
                    <input type="date" id="editar-fecha">
                </div>
                <div class="campo" style="grid-column: 1 / -1;">
                    <label for="editar-descripcion">Descripci√≥n</label>
                    <textarea id="editar-descripcion"></textarea>
                </div>
                <div class="campo" style="grid-column: 1 / -1;">
                    <label for="editar-etiquetas">Etiquetas (separadas por coma)</label>
                    <input type="text" id="editar-etiquetas" placeholder="Ej: trabajo, mensual">
                </div>
            </div>
            <div class="modal-botones">
                <button class="btn btn-secundario" onclick="cerrarModalEditar()">Cancelar</button>
                <button class="btn btn-primario" onclick="guardarEdicion()">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- ==================== JAVASCRIPT MODULAR ==================== -->
    <!-- Orden de carga importante: config -> storage -> categories -> movements -> charts -> ui -> app -->
    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/categories.js"></script>
    <script src="js/movements.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>

</body>
</html>
